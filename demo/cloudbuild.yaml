steps:
# increase depth of git clone and diff
- id: ğŸ—‚ï¸ Reset git to unshallow
  name: gcr.io/cloud-builders/git
  args:
    - fetch
    - '--unshallow'
- id: ğŸ—‚ï¸ Pulling git history
  name: gcr.io/cloud-builders/git
  args:
    - pull
    - origin
    - $REF_NAME
- id: ğŸ—‚ï¸ Comparing latest and most recent commits
  name: gcr.io/cloud-builders/git
  args:
    - diff
    - HEAD~1
    - '--output'
    - diff.txt

# â‰ï¸ Golang versions
- id: â‰ï¸ Golang Versions
  waitFor: ['-']
  name: "gcr.io/cloud-builders/go"
  args: ["version"]
  env: ["GOPATH=."]

# linter
# - id: ğŸ‘¨â€ğŸ’» Linter
#   waitFor: ['-']
#   name: "golangci/golangci-lint"
#   args: ["golangci-lint","run", "./ui/main.go"]

# unit Test
# - id: ğŸ§‘â€ğŸ”¬ Unit Test(s)
#   waitFor: ['-']
#   name: "gcr.io/cloud-builders/go"
#   args: ["test","./ui/main_test.go"]
#   env: ["GOPATH=."]

- id: ğŸ¤– Code PR Creator - https://github.com/GoogleCloudPlatform/microservices-demo/pull/2438
  name: 'europe-docker.pkg.dev/coffee-and-codey/buildey-image/buildey:latest'
  args:
    - buildey
    - document
    - merge
    - -f 
    - "demo/sample-code/2438-diff.txt"
  allowFailure: true

- id: ğŸ¤– Code review assistance - https://github.com/GoogleCloudPlatform/microservices-demo/pull/2438
  name: 'europe-docker.pkg.dev/coffee-and-codey/buildey-image/buildey:latest'
  args:
    - buildey
    - review
    - code
    - -f 
    - "demo/sample-code/2438-diff.txt"
  allowFailure: true

- id: ğŸ¤– Release notes assistance - https://github.com/GoogleCloudPlatform/microservices-demo/pull/2438
  name: 'europe-docker.pkg.dev/coffee-and-codey/buildey-image/buildey:latest'
  args:
    - buildey
    - document
    - release
    - -f 
    - "demo/sample-code/2438-diff.txt"
  allowFailure: true




options:
  # logging: CLOUD_LOGGING_ONLY
  defaultLogsBucketBehavior: REGIONAL_USER_OWNED_BUCKET
  requestedVerifyOption: VERIFIED
  dynamicSubstitutions: true